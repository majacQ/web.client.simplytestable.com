{% if plan_subscribe_success is defined and plan_subscribe_success != '' %}
    {% if plan_subscribe_success == 'already-on-plan' %}
<div class="alert alert-success for:input-website">
    <button type="button" class="close" data-dismiss="alert">×</button>
    <p><strong>You're already there!</strong></p>
    <p>
        You've already on the <strong>{{ user_summary.user_plan.plan.name }}</strong> plan.
    </p>
</div>                
        {% else %}
<div class="alert alert-success for:input-website">
    <button type="button" class="close" data-dismiss="alert">×</button>
    <p><strong>All done!</strong></p>
    <p>
        You've changed to the <strong>{{ user_summary.user_plan.plan.name }}</strong> plan.
    </p>
</div>                
    {% endif %}
{% endif %}

{% if plan_subscribe_error is defined and plan_subscribe_error != '' %}            
    {% if plan_subscribe_error == '403' %}
<div class="alert alert-error for:input-website">
    <button type="button" class="close" data-dismiss="alert">×</button>
    <p><strong>That didn't work</strong></p>
    <p>
        Looks like we're having trouble talking to our subscription service.                
    </p>
</div>            
    {% endif %}        
{% endif %}

<div class="plan-section">
    <p>
        You are on the <strong>{{ user_summary.user_plan.plan.name }}</strong> plan{% if user_summary.user_plan.plan.name == 'basic' %}. This is <strong>free of charge</strong> and always will be.
        {% else %}
        at <strong>&pound{{ user_summary.stripe_customer.subscription.plan.amount / 100 }} per {{ user_summary.stripe_customer.subscription.plan.interval }}</strong>.
        {% endif %}
        
        <!-- ($userSummary->stripe_customer->subscription->status  -->

        {% if user_summary.stripe_customer.subscription.status is defined %}
            {% if user_summary.stripe_customer.subscription.status == 'trialing' %}
        You are on day <strong>{{ user_summary.stripe_customer.subscription.day_of_trial_period }}</strong> of your <strong>{{ user_summary.stripe_customer.subscription.plan.trial_period_days }}</strong> day trial
        ending <strong>{{ user_summary.stripe_customer.subscription.trial_end|date("d") }} {{ user_summary.stripe_customer.subscription.trial_end|date("F") }} {{ user_summary.stripe_customer.subscription.trial_end|date("Y") }}</strong>.
            {% endif %}                    
        {% endif %}
    </p>            
</div>

<div class="plan-section">
    <h3>Monthly allowances</h3>
    <table class="table">
        <tbody>
            <tr>
                <th>Full-site test jobs per site</th>
                <td>Unlimited</td>
            </tr>
            <tr>
                <th>Single-URL tests</th>
                <td>Unlimited</td>
            </tr>
            <tr>
                <th>URLs per test job</th>
                <td>{% if plan.urls_per_job is defined %}{{ plan.urls_per_job }}{% else %}Unlimited{% endif %}</td>
            </tr>
            <tr>
                <th>Credits</th>
                <td>
                    {% if plan.credits is defined %}
                        {{ plan.credits.used }} of 
                        {{ plan.credits.limit }} used ({{ (plan.credits.used / plan.credits.limit) * 100 }}%)
                    {% else %}
                        Unlimited
                    {% endif %}                                
                </td>
            </tr>                
        </tbody>            
    </table>             
</div>

<div class="plan-section">
    <h3>Change plan</h3> 

            {% if user_summary.user_plan.plan.name == 'basic' %}
                {% if user_summary.user_plan.start_trial_period > 0  %}
    <p>
        Try any premium plan free for <strong>{{ user_summary.user_plan.start_trial_period }}</strong> day{% if user_summary.user_plan.start_trial_period != 1%}s{% endif %}.
    </p>                             
                {% endif %}
            {% else %}
            {% endif %}

            {% if user_summary.user_plan.plan.name !='basic' %}
                {% if plan.summary is defined %}
                    {% set trial_days_remaining = plan.summary.trial_period_days - plan.summary.days_of_trial_period + 1 %}                               
                    {% if trial_days_remaining > 0 %}
    <p>
        Switch between premium plans free for up to <strong>{{ trial_days_remaining }}</strong> day{% if trial_days_remaining != 1%}s{% endif %}.
    </p>                                
                    {% endif %}                            
                {% endif %}                                
            {% endif %}

    <form method="post" action="{{ path('user_account_plan_subscribe') }}">
        <div class="input-append">
            <select name="plan">
                <option value="basic" {% if user_summary.user_plan.plan.name == 'basic' %}selected{% endif %}>Basic (&pound;0)</option>
                <option value="personal" {% if user_summary.user_plan.plan.name == 'personal' %}selected{% endif %}>Personal (&pound;9)</option>
                <option value="agency" {% if user_summary.user_plan.plan.name == 'agency' %}selected{% endif %}>Agency (&pound;19)</option>
                <option value="business" {% if user_summary.user_plan.plan.name == 'business' %}selected{% endif %}>Business (&pound;59)</option>
                <option value="enterprise" {% if user_summary.user_plan.plan.name == 'enterprise' %}selected{% endif %}>Enterprise (&pound;299)</option>
            </select>  
            <button class="btn" type="submit">Subscribe</button>
        </div>
    </form>

    <a href="{{ public_site['urls']['home'] }}{{ public_site['urls']['plans_and_pricing'] }}">View plan and pricing details <i class="icon icon-caret-right"></i></a>
    
</div>

{% if stripe_event_data['invoice'] is defined and stripe_event_data['invoice'].date is defined%}
<div class="plan-section latest-invoice">
    <h2>Latest invoice</h2>
    {% include 'SimplyTestableWebClientBundle:Partials/User/Account:latest-invoice.html.twig' %} 
</div>
{% endif %}