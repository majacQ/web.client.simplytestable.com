{% extends 'SimplyTestableWebClientBundle::bs3/Abstract/single-page-dialog.html.twig' %}

{% set dialog_width = 6 %}

{% set title %}
    {% if remote_test.rejection.constraint is defined and remote_test.rejection.constraint is not null %}
        {% if is_logged_in %}
            Plan limit reached
        {% else %}
            Demo limit reached
        {% endif %}
    {% elseif remote_test.rejection.reason|slice(0, 4) == 'curl' %}
        Sorry, that can't be accessed at the moment
    {% else %}
        Oops, I can't do that
    {% endif %}
{% endset %}

{% block title %}{{ title }} {{ parent() }} {% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets
    '@SimplyTestableWebClientBundle/Resources/assets/bs3/css/cta.css'
    '@SimplyTestableWebClientBundle/Resources/assets/bs3/css/test-results-rejected.css'
    filter='cssrewrite' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{#{% block javascripts %}#}
    {#{{ parent() }}#}

    {#{% javascripts#}
    {#'@SimplyTestableWebClientBundle/Resources/assets/bs3/js/test-results-failednourlsdetected.js' %}#}
    {#<script type="text/javascript" src="{{ asset_url }}"></script>#}
    {#{% endjavascripts %}#}
{#{% endblock %}#}

{% block content %}

    <h1>{{ title }}</h1>

    {% if remote_test.rejection.constraint.name is defined and remote_test.rejection.constraint.name == 'credits_per_month' %}
        {% include 'SimplyTestableWebClientBundle:bs3/Partials/Test/Results/Rejected/CreditLimit:credit-limit.html.twig' %}
    {% endif %}

    {% if remote_test.rejection.constraint.name is defined and remote_test.rejection.constraint.name == 'full_site_jobs_per_site' %}
        {% include 'SimplyTestableWebClientBundle:bs3/Partials/Test/Results/Rejected:full-site.html.twig' %}
    {% endif %}

    {% if remote_test.rejection.constraint.name is defined and remote_test.rejection.constraint.name == 'single_url_jobs_per_url' %}
        {% include 'SimplyTestableWebClientBundle:bs3/Partials/Test/Results/Rejected:single-page.html.twig' %}
    {% endif %}

    {% if remote_test.rejection.constraint is null and remote_test.rejection.reason == 'unroutable' %}
        <p class="intro first">
            <span class="nowrap">Sorry, I can't test <a title="{{website.raw}}" href="{{ website.raw }}">{% include 'SimplyTestableWebClientBundle:Partials:/url/utf8-raw-possibly-truncated-40.html.twig' with {'url': website} %}</a></span> because it can't be accessed over the Internet.
        </p>

        <p class="intro">
            This happens if you try to test a website:
        </p>

        <ul>
            <li>
                <p class="intro">
                    that's accessed by IP address and where the IP address is not routable
                </p>
            </li>
            <li>
                <p class="intro">
                    that contains an invalid domain name (such as <a href="http://example/">http://example/</a>)
                </p>
            </li>
        </ul>

        <div class="cta">
            <a href="{{ path('app') }}" class="btn btn-primary btn-large"><i class="fa fa-caret-left"></i> Try testing a different site</a>
        </div>
    {% endif %}

    {% if remote_test.rejection.constraint is null and remote_test.rejection.reason|slice(0, 4) == 'curl' %}
        {% set curl_error_number = remote_test.rejection.reason|slice(5, 2) %}

        {% if curl_error_number == 7 %}
            {% set intro = 'there doesn\'t appear to be a web server there to talk to' %}
        {% elseif curl_error_number == 28 %}
            {% set intro = 'the web server didn\'t respond within 10 seconds' %}
            {% set advice %}
            <p class="intro">
                The web server for the site being tested is probably having
                some issues if it doesn't respond within 10 seconds.
            </p>
            <p class="intro">
                We won't run a test if a web server is responding slowly
                as doing so is likely to make matters worse.
            </p>
            {% endset %}
        {% elseif curl_error_number == 52 %}
            {% set intro = 'the web server returned no data whatsoever' %}
        {% endif %}

        <p class="intro">
            Were not able to talk to {{ test.formattedWebsite }} at the moment{% if intro is defined %}: {{ intro }}{% endif %}.
        </p>

        {% if advice is defined %}{{ advice }}{% endif %}

        <p class="intro">
            Check that <a href="{{ test.website }}">{{ test.formattedWebsite }}</a> is working as expected in a browser.
        </p>

        <div class="cta">
            <a href="{{ path('app') }}" class="btn btn-primary btn-large"><i class="fa fa-caret-left"></i> Try testing a different site</a>
        </div>

        <p class="support-hint">
            If you need to <a href="mailto:&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#115;&#105;&#109;&#112;&#108;&#121;&#116;&#101;&#115;&#116;&#97;&#98;&#108;&#101;&#46;&#99;&#111;&#109;">contact us</a>
            about this, tell us you encountered curl error {{ curl_error_number }}. We'll know what this means.
        </p>
    {% endif %}



{% endblock %}