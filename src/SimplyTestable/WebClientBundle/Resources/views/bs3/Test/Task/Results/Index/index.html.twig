{% extends 'SimplyTestableWebClientBundle::bs3/base.html.twig' %}

{% set is_failed = task.state in ['failed',  'failed-retry-available', 'failed-no-retry-available', 'failed-retry-limit-reached'] %}

{% block title %}Results for {% include 'SimplyTestableWebClientBundle:Partials:/url/utf8-schemeless-possibly-truncated-64.html.twig' with {'url': website_url} %} (Test#{{test.testId}} Task#{{task.taskId}}) - {{ parent() }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets
    '@SimplyTestableWebClientBundle/Resources/assets/vendor/color-themes-for-google-code-prettify/color-themes-for-google-code-prettify-1.0/build/assets/css/themes/github.css'
    '@SimplyTestableWebClientBundle/Resources/assets/bs3/css/full-width.css'
    '@SimplyTestableWebClientBundle/Resources/assets/bs3/css/test-task-results.css'
    filter='cssrewrite' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
    '@SimplyTestableWebClientBundle/Resources/assets/vendor/jquery-scrollto/jquery.scrollTo-1.4.12/jquery.scrollTo.js'
    '@SimplyTestableWebClientBundle/Resources/assets/vendor/google-code-prettify/google-code-prettify/prettify.js'
    '@SimplyTestableWebClientBundle/Resources/assets/bs3/js/test-task-results.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body_class %} {{ parent() }} full-width {% endblock %}

{% block body %}
    {{ parent() }}

    <div class="alert-container">
        {% if is_owner == false and is_public_user_test == false %}
            <div class="alert alert-info">
                <div class="container">
                    <i class="fa fa-flag"></i>
                    You're viewing a <strong>read-only version</strong> of this test.
                    <a href="{{ path('view_user_signin_index') }}">Sign in</a> if you're the test owner to
                    modify options and re-test.
                </div>
            </div>
        {% endif %}
    </div>

    <div class="header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="info">
                        {{ task.type }} report for
                        <a href="{{ path('app_results', { 'website': test.website, 'test_id': test.testId }) }}">
                            {% include 'SimplyTestableWebClientBundle:Partials:/url/utf8-raw-possibly-truncated-40.html.twig' with {'url': website_url} %}
                            <span id="test-id">(#{{ test.testId }})</span>
                        </a>
                        task
                        <span id="task-id">#{{task.taskId}}</span>
                    </h1>

                    <p>
                        Page tested: <a href="{{ task.url }}">{{ task.formattedUrl }}</a><span class="fade"></span>
                    </p>

                    {% if task.state == 'completed' %}
                        <div class="summary-stats">
                            {% include 'SimplyTestableWebClientBundle:bs3/Abstract/Partials/Test/Results/Task:issue-count.html.twig'
                            with { 'count': task.output.errorCount, 'name':'error' }
                            %}

                            {% include 'SimplyTestableWebClientBundle:bs3/Abstract/Partials/Test/Results/Task:issue-count.html.twig'
                            with { 'count': task.output.warningCount, 'negative':'primary', 'name':'warning' }
                            %}

                            {% if distinct_fixes is defined and distinct_fixes | length > 0 %}
                                {% include 'SimplyTestableWebClientBundle:bs3/Abstract/Partials/Test/Results/Task:issue-count.html.twig'
                                with { 'count': distinct_fixes | length, 'negative':'fixes', 'name':'fix', 'plural_suffix':'es' }
                                %}
                            {%  endif %}
                        </div>
                    {% else %}
                        failed or something
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        {% if is_failed %}
            {% include 'SimplyTestableWebClientBundle:bs3/Partials/Test/Results/Task/Failed:failed.html.twig' %}
        {% else %}
            {% include 'SimplyTestableWebClientBundle:bs3/Partials/Test/Results/Task/Succeeded:succeeded.html.twig' %}
        {% endif %}
    </div>

{% endblock %}